---
title: "Bacillus dispersion"
author: "William R. Shoemaker, Jay T. Lennon"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes:
  - \usepackage{array}
output: pdf_document
geometry: margin=2.54cm
editor_options: 
  chunk_output_type: console
---


```{r}
rm(list=ls())
getwd()
setwd("~/GitHub/Task2/PoolPopSeq")

# Load dependencies
require("vegan")

# Source code functions
source("R/ParEvol.R")
```


import data

```{r}
# pop-by-gene matrix
pop_by_gene <- c("data/gene_by_sample/B_S/sample_by_gene.txt")
df <- read.table(paste(pop_by_gene, collapse = ''), sep = "\t", header = TRUE, row.names = 1)
# select samples only from day 100
df <- df[grep('D100', rownames(df)), ]
# remove intergenic regions (if they're there)
df.noInter <- df[,!grepl('.B', colnames(df))]

# gene info dataframe
gene_path <- c("data/reference_assemblies_task2/reference_assemblies_task2_table/B.txt")
df.gene <- read.table(paste(gene_path, collapse = ''), sep = " ", header = TRUE, row.names = 1)
L <- sum(df.gene$Size)
df.gene$RelSize <- df.gene$Size / L
# sort df.gene according to column order in df
df.RelSize <- df.gene['RelSize']

df.merge <- merge(df.RelSize, t(df.noInter), by=0, all=TRUE)
rownames(df.merge) <- df.merge$Row.names
pmf <- df.merge$RelSize
df.merge <- subset(df.merge, select = -c(Row.names, RelSize) )
df.merge <- t(df.merge)
pop.muts <- rowSums(df.merge)
```


Get mean centroid distance using G-score matrix

```{r}
df.G <- make.G.matrix(df.merge, pmf)
df.G <- df.G[rowSums(df.G[,-1]) != 0,]
df.G <- df.G[, colSums(df.G != 0) > 0]
df.G.db <- vegdist(df.G, method = "bray", upper = TRUE, diag = TRUE)
df.G.groups <- substr(c(sapply(strsplit(rownames(df.G),"_"), `[`, 2)), 1, 3)
beta.disp <- betadisper(d = df.G.db, group = df.G.groups)
euc.mat <- get.euc.dist.2D(beta.disp)
euc.mean <- aggregate(eucs ~ treat.strain.names, euc.mat, FUN = function(x) mean(as.numeric(as.character(x))))
euc.var <- aggregate(eucs ~ treat.strain.names, euc.mat, FUN = function(x) var(as.numeric(as.character(x))))

```




Get mean centroid distance values from random G-score matrices

```{r}
# call function with 100 iterations
df.null.euc <- sim.euc.dist(df.merge, pop.muts, pmf, df.G.groups, 100)

```


Plot data

```{r}

```

